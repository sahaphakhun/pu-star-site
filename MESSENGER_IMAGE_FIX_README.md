# การแก้ไขปัญหาการส่งรูปภาพและ Quick Replies ใน Facebook Messenger

## ปัญหาที่พบ:

### 1. ปัญหาการส่งรูปภาพ (Error Code 100, Subcode 2018388)
```
"เซิร์ฟเวอร์ไม่สามารถอ่านไฟล์ได้ เนื่องจากไม่สามารถอ่านไฟล์จาก robots.txt 
หรือให้คุณเป็นผู้ครอบครองไฟล์เว็บเซิร์ฟเวอร์ หรือเพิ่มไฟล์ robots.txt 
ให้กับ Meta ไว้ในรายการที่อนุญาตให้เข้าถึง"
```

### 2. ปัญหาการส่ง Quick Replies (Error Code 100, Subcode 2018034)
```
"ข้อความต้องไม่เป็นค่าว่าง ต้องมีข้อความหรือไฟล์แนบ"
```

## วิธีแก้ไข:

### 1. แก้ไขการส่ง Quick Replies
- เปลี่ยนจาก `text: ''` เป็น `text: 'เลือกตัวเลือกด้านล่างได้เลยค่ะ'`
- แก้ไขในไฟล์ `src/bot/flows/entry.ts`

### 2. ปรับปรุงการจัดการข้อผิดพลาดในการส่งรูปภาพ
- เพิ่มการตรวจสอบความถูกต้องของ URL
- เพิ่มการตรวจสอบความสามารถในการเข้าถึง URL
- ส่งข้อความแจ้งเตือนแทนเมื่อรูปภาพไม่สามารถเข้าถึงได้
- แก้ไขในไฟล์ `src/utils/messenger-utils.ts`

### 3. สร้างไฟล์ robots.txt
- สร้างไฟล์ `public/robots.txt` เพื่อให้ Facebook สามารถเข้าถึงรูปภาพได้
- อนุญาตให้ Facebook bot และ crawler เข้าถึงไฟล์ทั้งหมด

## การเปลี่ยนแปลงที่ทำ:

### ใน entry.ts:
```typescript
// เปลี่ยนจาก
text: ''

// เป็น
text: 'เลือกตัวเลือกด้านล่างได้เลยค่ะ'
```

### ใน messenger-utils.ts:
```typescript
// เพิ่มฟังก์ชันตรวจสอบ URL
async function isUrlAccessible(url: string): Promise<boolean>

// ปรับปรุง sendImageMessage และ sendVideoMessage
// เพิ่มการตรวจสอบ URL และการจัดการข้อผิดพลาด
```

### ไฟล์ robots.txt:
```
User-agent: *
Allow: /

User-agent: facebookexternalhit
Allow: /

User-agent: facebookbot
Allow: /
```

## ผลลัพธ์ที่คาดหวัง:

1. **Quick Replies จะส่งได้ปกติ** - ไม่มีข้อผิดพลาด "ข้อความต้องไม่เป็นค่าว่าง"
2. **รูปภาพจะส่งได้ดีขึ้น** - มีการตรวจสอบ URL และจัดการข้อผิดพลาดที่ดีขึ้น
3. **Facebook สามารถเข้าถึงรูปภาพได้** - ผ่าน robots.txt ที่ถูกต้อง
4. **ประสบการณ์ผู้ใช้ดีขึ้น** - มีข้อความแจ้งเตือนเมื่อรูปภาพไม่สามารถแสดงได้

## หมายเหตุ:

- การแก้ไขนี้จะช่วยลดข้อผิดพลาดในการส่งข้อความ
- ระบบจะมีความทนทานต่อข้อผิดพลาดมากขึ้น
- ผู้ใช้จะได้รับข้อความที่ชัดเจนเมื่อมีปัญหา
