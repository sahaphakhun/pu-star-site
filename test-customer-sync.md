# ทดสอบระบบการซิงค์ชื่อลูกค้า

## การแก้ไขที่ทำไปแล้ว

### 1. ปรับปรุงฟังก์ชันการซิงค์ชื่อลูกค้า (`src/utils/userNameSync.ts`)
- เพิ่มฟังก์ชัน `normalizePhoneNumber()` สำหรับแปลงเบอร์โทรศัพท์ให้เป็นรูปแบบมาตรฐาน
- เพิ่มฟังก์ชัน `isSamePhoneNumber()` สำหรับตรวจสอบว่าเบอร์โทรศัพท์สองเบอร์เป็นเบอร์เดียวกันหรือไม่
- ปรับปรุงฟังก์ชัน `syncUserNameFromFirstOrder()` ให้ค้นหาออเดอร์จากเบอร์โทรศัพท์แทน userId
- รองรับเบอร์โทรศัพท์ทั้งสองรูปแบบ (0 และ 66)

### 2. ปรับปรุงหน้าออเดอร์ (`src/app/(shop)/admin/orders/page.tsx`)
- เพิ่ม interface `SystemCustomer` สำหรับข้อมูลลูกค้าจากระบบ
- เพิ่ม state `systemCustomers` สำหรับเก็บข้อมูลลูกค้าจากระบบ
- เพิ่มฟังก์ชัน `fetchSystemCustomers()` สำหรับดึงข้อมูลลูกค้าจากระบบ
- แก้ไขการแสดงผลชื่อลูกค้าให้แสดงทั้งชื่อจากฟอร์มสั่งซื้อและชื่อจากระบบ
- แสดงชื่อลูกค้าจากระบบในรูปแบบ badge สีน้ำเงิน

### 3. ปรับปรุง API endpoint (`src/app/api/admin/customers/route.ts`)
- เพิ่ม action `getCustomersByIds` สำหรับดึงข้อมูลลูกค้าตาม ID
- ปรับปรุง action `syncCustomerName` ให้ใช้เบอร์โทรศัพท์ในการค้นหาออเดอร์

### 4. ปรับปรุงหน้าลูกค้า (`src/app/(shop)/admin/customers/page.tsx`)
- แก้ไขฟังก์ชัน `handleSyncCustomerName` ให้ส่งเบอร์โทรศัพท์แทน customerName

## วิธีการทำงานใหม่

### การซิงค์ชื่อลูกค้า
1. เมื่อกดปุ่ม "ซิงค์ชื่อ" ในหน้าลูกค้า ระบบจะส่งเบอร์โทรศัพท์ของลูกค้าไปยัง API
2. ระบบจะค้นหาออเดอร์แรกของลูกค้าจากเบอร์โทรศัพท์ (รองรับทั้งรูปแบบ 0 และ 66)
3. หากพบออเดอร์และมีชื่อลูกค้าในออเดอร์ ระบบจะอัปเดตชื่อลูกค้าในระบบ
4. หากไม่พบออเดอร์หรือไม่มีชื่อลูกค้าในออเดอร์ ระบบจะแสดงข้อความแจ้งเตือน

### การแสดงชื่อลูกค้าในหน้าออเดอร์
1. ระบบจะแสดงชื่อลูกค้าจากฟอร์มสั่งซื้อเป็นชื่อหลัก
2. หากออเดอร์มี userId และมีข้อมูลลูกค้าในระบบ ระบบจะแสดงชื่อลูกค้าจากระบบในรูปแบบ badge สีน้ำเงิน
3. ชื่อลูกค้าจากระบบจะแสดงในรูปแบบ "ชื่อในระบบ: [ชื่อลูกค้า]"

## การทดสอบ

### ทดสอบการซิงค์ชื่อลูกค้า
1. ไปที่หน้าลูกค้า (`/admin/customers`)
2. ค้นหาลูกค้าที่มีชื่อเป็น "ลูกค้า"
3. กดปุ่ม "ซิงค์ชื่อ"
4. ตรวจสอบว่าชื่อลูกค้าถูกอัปเดตหรือไม่

### ทดสอบการแสดงชื่อลูกค้าในหน้าออเดอร์
1. ไปที่หน้าออเดอร์ (`/admin/orders`)
2. ตรวจสอบว่าออเดอร์ที่มี userId แสดงชื่อลูกค้าทั้งสองแบบหรือไม่
3. ตรวจสอบว่าชื่อลูกค้าจากระบบแสดงในรูปแบบ badge สีน้ำเงินหรือไม่

## หมายเหตุ
- ระบบจะรองรับเบอร์โทรศัพท์ทั้งสองรูปแบบ (0 และ 66) โดยอัตโนมัติ
- การซิงค์ชื่อลูกค้าจะใช้ข้อมูลจากออเดอร์แรกของลูกค้าเท่านั้น
- หากลูกค้าไม่มีออเดอร์ ระบบจะไม่สามารถซิงค์ชื่อได้
