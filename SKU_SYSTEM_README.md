# ระบบ SKU Configuration

ระบบสร้างรหัส SKU อัตโนมัติสำหรับสินค้าในระบบ PU Star

## คุณสมบัติหลัก

### 1. การสร้าง SKU อัตโนมัติ
- สร้างรหัส SKU ตามรูปแบบที่กำหนด
- รองรับตัวแปรหลายแบบ เช่น คำนำหน้า ตัวนับ หมวดหมู่ วันที่
- ระบบตัวนับอัตโนมัติที่เพิ่มขึ้นเรื่อยๆ

### 2. รูปแบบ SKU ที่รองรับ
- `{PREFIX}` - คำนำหน้า SKU (เช่น GEN, SIL, TOOL)
- `{COUNTER}` - ตัวนับ (4 หลัก, เริ่มต้นที่ 0001)
- `{CATEGORY}` - หมวดหมู่สินค้า
- `{YEAR}` - ปี (4 หลัก, เช่น 2024)
- `{MONTH}` - เดือน (2 หลัก, เช่น 01-12)
- `{DAY}` - วัน (2 หลัก, เช่น 01-31)

### 3. ตัวอย่างรูปแบบ SKU
- **รูปแบบพื้นฐาน**: `GEN-0001`, `GEN-0002`
- **รูปแบบหมวดหมู่**: `SIL-กาวและซีล-0001`
- **รูปแบบวันที่**: `TOOL-202412-0001`
- **รูปแบบปี**: `PART-2024-0001`
- **รูปแบบแบบกำหนดเอง**: `MAT-วัสดุก่อสร้าง-2024-0001`

## การติดตั้งและใช้งาน

### 1. รัน Seed Data
```bash
node src/scripts/seed-sku-configs.js
```

### 2. เข้าถึงหน้าแอดมิน
- ไปที่ `/admin/sku-configs` เพื่อจัดการ SKU Configuration
- ไปที่ `/admin/products` เพื่อสร้างสินค้าและใช้ SKU อัตโนมัติ

### 3. การสร้าง SKU Configuration ใหม่
1. คลิก "สร้าง SKU Config ใหม่"
2. กรอกข้อมูล:
   - **ชื่อรูปแบบ SKU**: ชื่อที่อธิบายรูปแบบนี้
   - **คำนำหน้า SKU**: ตัวอักษรนำหน้า (สูงสุด 10 ตัว)
   - **รูปแบบ SKU**: รูปแบบที่ต้องการ (ใช้ตัวแปรข้างต้น)
   - **หมวดหมู่**: หมวดหมู่สินค้าที่ใช้รูปแบบนี้
   - **ตัวนับเริ่มต้น**: ตัวนับเริ่มต้น (เริ่มต้นที่ 1)
   - **คำอธิบาย**: คำอธิบายเพิ่มเติม
   - **เปิดใช้งาน**: เปิด/ปิดการใช้งาน

### 4. การใช้ SKU ในหน้าสินค้า
1. ไปที่หน้า "จัดการสินค้า"
2. เลือกรูปแบบ SKU จาก dropdown
3. คลิก "สร้าง SKU" เพื่อสร้างรหัสอัตโนมัติ
4. ระบบจะแสดง SKU ที่สร้างขึ้น

## โครงสร้างไฟล์

```
src/
├── models/
│   └── SKUConfig.ts              # โมเดล SKU Configuration
├── app/
│   └── (shop)/
│       └── admin/
│           ├── sku-configs/      # หน้าแอดมิน SKU Configuration
│           └── products/         # หน้าแอดมินสินค้า (ปรับปรุงแล้ว)
└── api/
    └── admin/
        └── sku-configs/          # API สำหรับจัดการ SKU
            ├── route.ts           # GET, POST
            ├── [id]/route.ts      # GET, PUT, DELETE
            └── generate/route.ts  # สร้าง SKU อัตโนมัติ
```

## API Endpoints

### 1. ดึงข้อมูล SKU Config ทั้งหมด
```
GET /api/admin/sku-configs
GET /api/admin/sku-configs?category=กาวและซีล
GET /api/admin/sku-configs?isActive=true
```

### 2. สร้าง SKU Config ใหม่
```
POST /api/admin/sku-configs
Body: {
  "name": "ชื่อรูปแบบ",
  "prefix": "GEN",
  "format": "{PREFIX}-{COUNTER}",
  "category": "หมวดหมู่",
  "description": "คำอธิบาย"
}
```

### 3. อัปเดต SKU Config
```
PUT /api/admin/sku-configs/[id]
Body: {
  "name": "ชื่อใหม่",
  "prefix": "NEW",
  "format": "{PREFIX}-{YEAR}-{COUNTER}"
}
```

### 4. ลบ SKU Config
```
DELETE /api/admin/sku-configs/[id]
```

### 5. สร้าง SKU อัตโนมัติ
```
POST /api/admin/sku-configs/generate
Body: {
  "configId": "id ของ SKU Config",
  "productName": "ชื่อสินค้า",
  "category": "หมวดหมู่สินค้า"
}
```

## การทำงานของระบบ

### 1. การสร้าง SKU
1. ผู้ใช้เลือกรูปแบบ SKU ในหน้าสินค้า
2. คลิก "สร้าง SKU"
3. ระบบเรียก API `/api/admin/sku-configs/generate`
4. ระบบแทนที่ตัวแปรในรูปแบบตามข้อมูลจริง
5. เพิ่มตัวนับและบันทึกลงฐานข้อมูล
6. ส่งคืน SKU ที่สร้างให้ผู้ใช้

### 2. การจัดการตัวนับ
- แต่ละ SKU Config มีตัวนับแยกกัน
- ตัวนับจะเพิ่มขึ้นเรื่อยๆ ทุกครั้งที่สร้าง SKU
- ตัวนับเริ่มต้นที่ 1 และเพิ่มทีละ 1

### 3. การตรวจสอบความซ้ำ
- ระบบตรวจสอบว่า prefix ไม่ซ้ำกัน
- รองรับการแก้ไขโดยไม่ทำให้ prefix ซ้ำ

## ตัวอย่างการใช้งาน

### 1. สร้าง SKU Configuration สำหรับกาว
```json
{
  "name": "กาวและซีล",
  "prefix": "SIL",
  "format": "{PREFIX}-{CATEGORY}-{COUNTER}",
  "category": "กาวและซีล",
  "description": "รูปแบบ SKU สำหรับสินค้ากาวและซีล"
}
```

### 2. ผลลัพธ์ที่ได้
- SKU แรก: `SIL-กาวและซีล-0001`
- SKU ที่สอง: `SIL-กาวและซีล-0002`
- SKU ที่สาม: `SIL-กาวและซีล-0003`

### 3. การใช้งานในหน้าสินค้า
1. เลือกรูปแบบ "กาวและซีล"
2. คลิก "สร้าง SKU"
3. ระบบจะสร้าง SKU อัตโนมัติ
4. แสดงผลลัพธ์: `SIL-กาวและซีล-0001`

## การบำรุงรักษา

### 1. การตรวจสอบข้อมูล
- ตรวจสอบ SKU Config ที่ไม่ใช้งาน
- ตรวจสอบตัวนับที่ผิดปกติ
- ตรวจสอบ prefix ที่ซ้ำกัน

### 2. การสำรองข้อมูล
- สำรองข้อมูล SKU Config เป็นประจำ
- เก็บประวัติการเปลี่ยนแปลง
- ตรวจสอบความถูกต้องของข้อมูล

### 3. การอัปเดตระบบ
- อัปเดตรูปแบบ SKU ตามความต้องการ
- เพิ่มตัวแปรใหม่ตามความจำเป็น
- ปรับปรุงประสิทธิภาพการสร้าง SKU

## ข้อควรระวัง

1. **Prefix ซ้ำ**: ระบบไม่อนุญาตให้มี prefix ซ้ำกัน
2. **ตัวนับ**: ตัวนับจะเพิ่มขึ้นเรื่อยๆ ไม่สามารถรีเซ็ตได้
3. **รูปแบบ**: ตรวจสอบรูปแบบให้ถูกต้องก่อนใช้งาน
4. **การลบ**: การลบ SKU Config จะทำให้ไม่สามารถสร้าง SKU ในรูปแบบนั้นได้

## การแก้ไขปัญหา

### 1. SKU ไม่แสดงผล
- ตรวจสอบว่า SKU Config เปิดใช้งานอยู่
- ตรวจสอบการเชื่อมต่อฐานข้อมูล
- ตรวจสอบ console error

### 2. ไม่สามารถสร้าง SKU ได้
- ตรวจสอบว่าเลือก SKU Config แล้ว
- ตรวจสอบสิทธิ์การเข้าถึง
- ตรวจสอบ API response

### 3. ตัวนับผิดปกติ
- ตรวจสอบข้อมูลในฐานข้อมูล
- รีเซ็ตตัวนับถ้าจำเป็น
- ตรวจสอบการทำงานของ API

## การพัฒนาต่อ

### 1. ฟีเจอร์ที่อาจเพิ่ม
- การนำเข้า/ส่งออก SKU Config
- การจัดการ SKU แบบ batch
- การตรวจสอบความถูกต้องของ SKU
- การสร้าง SKU แบบ bulk

### 2. การปรับปรุงประสิทธิภาพ
- การแคชข้อมูล SKU Config
- การสร้าง SKU แบบ async
- การจัดการ memory usage
- การ optimize database queries
