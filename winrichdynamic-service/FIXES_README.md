# ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤ B2B Service - ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î

## üêõ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. **Mongoose Warning - Duplicate Index**

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** 
```
[MONGOOSE] Warning: Duplicate schema index on {"name":1} found
[MONGOOSE] Warning: Duplicate schema index on {"quotationNumber":1} found
```

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏°‡∏µ `unique: true` ‡πÉ‡∏ô schema ‡πÅ‡∏•‡∏∞ `schema.index()` ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î duplicate index

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‚úÖ ‡∏•‡∏ö `unique: true` ‡∏à‡∏≤‡∏Å Role schema
- ‚úÖ ‡∏•‡∏ö `unique: true` ‡∏à‡∏≤‡∏Å Quotation schema
- ‚úÖ ‡πÉ‡∏ä‡πâ `schema.index()` ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß - ‡πÑ‡∏°‡πà‡∏°‡∏µ duplicate index warning

### 2. **404 Not Found - API /api/auth/send-otp**

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** API endpoint ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á OTP ‡πÑ‡∏°‡πà‡∏°‡∏µ

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á `/api/auth/send-otp` endpoint
- ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á `/api/auth/verify-otp` endpoint
- ‚úÖ ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö OTP ‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏´‡∏•‡∏±‡∏Å (DeeSMSx)
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á OTP

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß - API OTP ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ

### 3. **‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö**

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Admin model ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ `phone` ‡πÅ‡∏ó‡∏ô `password`
- ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏° `company` field
- ‚úÖ ‡πÉ‡∏ä‡πâ phone ‡πÄ‡∏õ‡πá‡∏ô unique identifier
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå

**‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:** ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß - ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö

## üîß API Endpoints ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà

### 1. **POST /api/auth/send-otp**
```typescript
// Request
{
  "phone": "0995429353"
}

// Response
{
  "success": true,
  "message": "‡∏™‡πà‡∏á OTP ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
  "data": {
    "phone": "0995429353",
    "expiresIn": 300,
    "adminName": "Possatorn Theerapongsakorn"
  }
}
```

### 2. **POST /api/auth/verify-otp**
```typescript
// Request
{
  "phone": "0995429353",
  "otp": "123456"
}

// Response
{
  "success": true,
  "message": "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
  "data": {
    "token": "jwt_token_here",
    "admin": {
      "id": "admin_id",
      "name": "Possatorn Theerapongsakorn",
      "phone": "66995429353",
      "email": "email@example.com",
      "company": "Company Name",
      "role": "admin",
      "roleLevel": 1
    }
  }
}
```

## üìã ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö OTP

### 1. **‡∏™‡πà‡∏á OTP**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
2. ‡∏™‡πà‡∏á OTP ‡∏ú‡πà‡∏≤‡∏ô DeeSMSx
3. ‡∏´‡∏≤‡∏Å SMS ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡πÉ‡∏ä‡πâ Mock OTP
4. ‡πÄ‡∏Å‡πá‡∏ö OTP ‡πÉ‡∏ô cache (5 ‡∏ô‡∏≤‡∏ó‡∏µ)

### 2. **‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô OTP**
1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö OTP ‡πÉ‡∏ô cache
2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏•‡∏≠‡∏á (‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á)
3. ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô OTP ‡∏ú‡πà‡∏≤‡∏ô DeeSMSx ‡∏´‡∏£‡∏∑‡∏≠ Mock
4. ‡∏™‡∏£‡πâ‡∏≤‡∏á JWT token
5. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï lastLoginAt

### 3. **OTP System**
- **DeeSMSx:** OTP ‡∏à‡∏£‡∏¥‡∏á‡∏ú‡πà‡∏≤‡∏ô SMS
- **Integration:** ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏´‡∏•‡∏±‡∏Å‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß

## üöÄ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö

### 1. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å**
```bash
curl -X POST https://www.b2b.winrichdynamic.com/api/adminb2b/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Test User",
    "phone": "0995429353",
    "email": "test@example.com",
    "company": "Test Company",
    "role": "admin"
  }'
```

### 2. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á OTP**
```bash
curl -X POST https://www.b2b.winrichdynamic.com/api/auth/send-otp \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "0995429353"
  }'
```

### 3. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô OTP**
```bash
curl -X POST https://www.b2b.winrichdynamic.com/api/auth/verify-otp \
  -H "Content-Type: application/json" \
  -d '{
    "phone": "0995429353",
    "otp": "123456"
  }'
```

## üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

### **‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå**
- **Input:** ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö 9-10 ‡∏´‡∏•‡∏±‡∏Å (0995429353, 0812345678)
- **Storage:** ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô 66xxxxxxxxx ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- **Display:** ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô 0xxxxxxxxx ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ UI

### **OTP System**
- **Expiration:** 5 ‡∏ô‡∏≤‡∏ó‡∏µ
- **Attempts:** ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
- **Integration:** ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏´‡∏•‡∏±‡∏Å
- **Security:** JWT token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÉ‡∏ô 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á

### **Database**
- **Admin Model:** ‡πÉ‡∏ä‡πâ phone ‡πÅ‡∏ó‡∏ô password
- **Unique Fields:** phone, email
- **Indexes:** ‡πÑ‡∏°‡πà‡∏°‡∏µ duplicate index
- **Timestamps:** createdAt, updatedAt, lastLoginAt

## ‚úÖ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

**‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:** ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢  
**Duplicate Index:** ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß  
**API OTP:** ‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß  
**Admin Model:** ‚úÖ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÅ‡∏•‡πâ‡∏ß  
**User Authentication:** ‚úÖ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ  
**Phone Validation:** ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß  

## üîÑ ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ

1. **‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö** - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
2. **‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö** - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô
3. **‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å** - ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
4. **‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö** - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö OTP system
5. **‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö** - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤, ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå

---

## üéØ ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö B2B service ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß:
- ‚úÖ ‡πÑ‡∏°‡πà‡∏°‡∏µ Mongoose warning
- ‚úÖ API OTP ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ
- ‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
- ‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢ OTP ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå‡πÑ‡∏ó‡∏¢
