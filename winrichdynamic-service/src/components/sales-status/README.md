# คอมโพเนนต์สถานะการขาย

โฟลเดอรีนี้ประกอบด้วยคอมโพเนนต์สำหรับจัดการสถานะการขายของลูกค้าในระบบ B2B

## คอมโพเนนต์ที่มีอยู่

### 1. ProductProposalForm.tsx
- **คำอธิบาย**: คอมโพเนนต์สำหรับสถานะ "นำเสนอสินค้า"
- **ฟังก์ชันหลัก**:
  - จัดการที่อยู่บริษัท
  - อัปโหลดรูปหน้าร้าน
  - บันทึกรายละเอียดร้านค้า
  - จัดการโอกาสการขาย (สินค้าที่ใช้ปัจจุบยัน)
  - จัดการสินค้าอนาคตที่คิดว่าจะใช้
- **การใช้งาน**: เรียกใช้ผ่านปุ่ม "นำเสนอสินค้า" ในหน้าลูกค้าเมื่อสถานะเป็น "planning"

### 2. QuotationForm.tsx
- **คำอธิบาย**: คอมโพเนนต์สำหรับสถานะ "เสนอราคา"
- **ฟังก์ชันหลัก**:
  - แสดงประวัติใบเสนอราคา
  - จัดการรายการสินค้า (ชื่อสินค้า, จำนวน, ราคา)
  - คำนวณยอดรวมอัตโนมัติ
  - บันทึกเหตุผลของการสร้างใบเสนอราคาใหม่
- **การใช้งาน**: เรียกใช้ผ่านปุ่ม "เสนอราคา" ในหน้าลูกค้าเมื่อสถานะเป็น "proposed"

### 3. SampleTestingForm.tsx
- **คำอธิบาย**: คอมโพเนนต์สำหรับสถานะ "ทดสอบตัวอย่างสินค้า"
- **ฟังก์ชันหลัก**:
  - แสดงประวัติการเบิก
  - จัดการรายการเบิก (สินค้า, จำนวน)
  - อัปโหลดรูปภาพแนบการทดสอบ
  - สร้างใบรับสินค้าตัวอย่าง (ฉบับบริษัทและฉบับลูกค้า)
- **การใช้งาน**: เรียกใช้ผ่านปุ่ม "ทดสอบตัวอย่าง" ในหน้าลูกค้าเมื่อสถานะเป็น "quoted"

### 4. PriceApprovalForm.tsx
- **คำอธิบาย**: คอมโพเนนต์สำหรับสถานะ "อนุมัติราคา"
- **ฟังก์ชันหลัก**:
  - จัดการข้อมูลการขออนุมัติเครดิต
  - อัปโหลดเอกสารที่เกี่ยวข้อง (สเตทเมนต์, หนังสือรับรองบริษัท, บัตรประชาชน, ฯลฯ)
  - สร้างเอกสารขออนุมัติเครดิต
  - จัดการวงเงินเครดิตและระยะเวลาการชำระเงิน
- **การใช้งาน**: เรียกใช้ผ่านปุ่ม "อนุมัติราคา" ในหน้าลูกค้าเมื่อสถานะเป็น "testing"

### 5. CustomerTagManager.tsx
- **คำอธิบาย**: คอมโพเนนต์สำหรับจัดการแท็กลูกค้า
- **ฟังก์ชันหลัก**:
  - แสดงแท็กที่มีอยู่แล้ว
  - ค้นหาและเพิ่มแท็กใหม่
  - จัดกลุ่มแท็กตามประเภทธุรกิจ (ช่างติดตั้ง, ร้านขายเส้น, ฯลฯ)
  - จัดกลุ่มแท็กตามผลิตภัณฑ์ (PU40, 6134, ฯลฯ)
  - จัดกลุ่มแท็กตามภูมิภาค
- **การใช้งาน**: เรียกใช้ผ่านปุ่ม "จัดการแท็ก" ในหน้าลูกค้า

## การเชื่อมโยงกับหน้า Customers.tsx

คอมโพเนนต์เหล่านี้ถูกเชื่อมโยงกับหน้าลูกค้า (`src/features/jubili/pages/Customers.tsx`) ผ่าน:

1. **การ import**: นำเข้าคอมโพเนนต์ทั้งหมด
2. **การจัดการ state**: ใช้ useState สำหรับควบคุมแต่ละฟอร์ม
3. **การแสดงปุ่ม**: แสดงปุ่มที่เหมาะสมกับสถานะปัจจุบันของลูกค้า
4. **การส่งข้อมูล**: ส่งข้อมูลไปยัง API `/api/customers/[id]` ผ่าน method PUT

## โครงสร้างข้อมูล

### โมเดล Customer (src/models/Customer.ts)
ได้รับการอัปเดตเพื่อรองรับข้อมูลสถานะการขาย:

- `status`: สถานะการขาย (planning, proposed, quoted, testing, approved, closed)
- `companyPhoto`: รูปหน้าร้าน
- `storeDetails`: รายละเอียดร้านค้า
- `salesOpportunities`: โอกาสการขาย (array)
- `futureProducts`: สินค้าอนาคต (array)
- `quotationHistory`: ประวัติใบเสนอราคา (array)
- `newQuotationReason`: เหตุผลของการสร้างใบเสนอราคาใหม่
- `sampleRequestHistory`: ประวัติการเบิก (array)
- `sampleReceipt`: ใบรับสินค้าตัวอย่าง (object)
- `creditApproval`: ข้อมูลการอนุมัติเครดิต (object)

### Schema Validation (src/schemas/customer.ts)
ได้รับการอัปเดตเพื่อรองรับการตรวจสอบข้อมูลสำหรับฟิลด์ใหม่ทั้งหมด

## API Endpoint

### PUT /api/customers/[id]
- **คำอธิบาย**: อัปเดตข้อมูลลูกค้า
- **Method**: PUT
- **Request Body**: ข้อมูลลูกค้าที่ต้องการอัปเดต
- **Response**: ข้อมูลลูกค้าที่อัปเดตแล้ว
- **Error Handling**: ตรวจสอบข้อมูลและส่ง error message ที่เหมาะสม

## การใช้งาน

1. เริ่มต้นจากสถานะ "วางแผน" (planning)
2. คลิกปุ่ม "นำเสนอสินค้า" เพื่อกรอกข้อมูลและอัปโหลดเอกสาร
3. หลังจากนั้นสถานะจะเปลี่ยนเป็น "นำเสนอสินค้า" (proposed)
4. คลิกปุ่ม "เสนอราคา" เพื่อสร้างใบเสนอราคา
5. หลังจากนั้นสถานะจะเปลี่ยนเป็น "เสนอราคา" (quoted)
6. คลิกปุ่ม "ทดสอบตัวอย่าง" เพื่อขอทดสอบสินค้า
7. หลังจากนั้นสถานะจะเปลี่ยนเป็น "ทดสอบตัวอย่างสินค้า" (testing)
8. คลิกปุ่ม "อนุมัติราคา" เพื่อขออนุมัติเครดิต
9. หลังจากนั้นสถานะจะเปลี่ยนเป็น "อนุมัติราคา" (approved)
10. สามารถใช้ปุ่ม "จัดการแท็ก" เพื่อจัดการแท็กของลูกค้าได้ตลอดเวลา

## หมายเหตุ

- คอมโพเนนต์ทั้งหมดถูกออกแบบมาให้รองรับการทำงานแบบ Responsive
- มีการตรวจสอบข้อมูล (validation) ที่เข้มงวด
- มีการจัดการ error state และแสดงข้อความผิดพลาด
- มีการแสดงสถานะ loading ระหว่างรอการประมวลผล