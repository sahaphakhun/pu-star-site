# WinRich Dynamic Service - Debug Guide

## üîß ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡πà‡∏≤ "‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡∏∞‡πÉ‡∏´‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÉ‡∏´‡∏°‡πà" ‡∏ó‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏û‡∏∂‡πà‡∏á‡∏Å‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏°‡∏≤ (‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á 10 ‡∏ô‡∏≤‡∏ó‡∏µ)

### ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤
1. **‡πÑ‡∏ü‡∏•‡πå `useTokenManager` ‡∏´‡∏≤‡∏¢‡πÑ‡∏õ** - ‡πÇ‡∏Ñ‡πâ‡∏î‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° import hook ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà
2. **‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ JWT token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á token
3. **Middleware ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ token ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°** - ‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö token expiration
4. **‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ cookie ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á** - token ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô cookie

### ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥

#### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå `useTokenManager` Hook
- **‡πÑ‡∏ü‡∏•‡πå:** `src/utils/tokenManager.ts`
- **‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà:** ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ JWT token ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
- **‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå:**
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö token ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î component
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á token ‡∏ú‡πà‡∏≤‡∏ô API
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
  - ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ authentication

#### 2. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Middleware
- **‡πÑ‡∏ü‡∏•‡πå:** `middleware.ts`
- **‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:**
  - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö token expiration
  - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ API routes
  - ‡πÄ‡∏û‡∏¥‡πà‡∏° logging ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö debugging
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error cases ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô

#### 3. ‡∏™‡∏£‡πâ‡∏≤‡∏á API Endpoints
- **‡πÑ‡∏ü‡∏•‡πå:** `src/app/api/adminb2b/validate-token/route.ts`
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á JWT token
  - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö token expiration
  - ‡∏™‡πà‡∏á‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• admin

- **‡πÑ‡∏ü‡∏•‡πå:** `src/app/api/auth/send-otp/route.ts`
  - ‡∏™‡πà‡∏á OTP ‡∏ú‡πà‡∏≤‡∏ô DeeSMSx
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ OTP cache

- **‡πÑ‡∏ü‡∏•‡πå:** `src/app/api/auth/verify-otp/route.ts`
  - ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô OTP ‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á JWT token
  - ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ cookie ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö token

- **‡πÑ‡∏ü‡∏•‡πå:** `src/app/api/auth/logout/route.ts`
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
  - ‡∏•‡∏ö cookie token

#### 4. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏´‡∏ô‡πâ‡∏≤ Login
- **‡πÑ‡∏ü‡∏•‡πå:** `src/app/adminb2b/login/page.tsx`
- **‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:**
  - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ token ‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô
  - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡πÉ‡∏´‡πâ cookie ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
  - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£ redirect

#### 5. ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏´‡∏ô‡πâ‡∏≤ Products
- **‡πÑ‡∏ü‡∏•‡πå:** `src/app/adminb2b/products/page.tsx`
- **‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á:**
  - ‡πÉ‡∏ä‡πâ `useTokenManager` ‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ token ‡πÅ‡∏ö‡∏ö‡πÄ‡∏î‡∏¥‡∏°
  - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö authentication
  - ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á UI ‡πÅ‡∏•‡∏∞ UX

#### 6. ‡∏™‡∏£‡πâ‡∏≤‡∏á Models ‡πÅ‡∏•‡∏∞ Schemas
- **‡πÑ‡∏ü‡∏•‡πå:** `src/models/Admin.ts` - Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö admin users
- **‡πÑ‡∏ü‡∏•‡πå:** `src/models/Role.ts` - Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö user roles
- **‡πÑ‡∏ü‡∏•‡πå:** `src/models/Product.ts` - Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
- **‡πÑ‡∏ü‡∏•‡πå:** `src/models/Category.ts` - Model ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà

#### 7. ‡∏™‡∏£‡πâ‡∏≤‡∏á Utility Files
- **‡πÑ‡∏ü‡∏•‡πå:** `src/utils/phoneUtils.ts` - ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
- **‡πÑ‡∏ü‡∏•‡πå:** `src/config/deesmsx.ts` - ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ DeeSMSx API
- **‡πÑ‡∏ü‡∏•‡πå:** `src/lib/mongodb.ts` - ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### ‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

#### 1. ‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
```typescript
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á OTP ‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
// ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô OTP ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏à‡∏∞‡πÑ‡∏î‡πâ JWT token
// token ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô localStorage ‡πÅ‡∏•‡∏∞ cookie
```

#### 2. ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Token
```typescript
// ‡πÉ‡∏ä‡πâ useTokenManager hook
const { getValidToken, logout, isAuthenticated } = useTokenManager();

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö token ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
const token = await getValidToken();
if (!token) {
  logout();
  return;
}
```

#### 3. ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
```typescript
// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å logout() function
// ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏•‡∏ö token ‡πÅ‡∏•‡∏∞ redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login
```

### ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variables

```env
# JWT Secret (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å)
JWT_SECRET=your_super_secret_jwt_key_here

# MongoDB
MONGODB_URI=mongodb://localhost:27017/winrichdynamic

# DeeSMSx
DEESMSX_API_KEY=your_api_key
DEESMSX_SECRET_KEY=your_secret_key
DEESMSX_SENDER_NAME=deeSMS.OTP
```

### ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

#### 1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
- ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ `/adminb2b/login`
- ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö OTP
- ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô OTP ‡πÅ‡∏•‡∏∞‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö

#### 2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
- ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤ `/adminb2b/products`
- ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà"
- ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
- ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô

#### 3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏ã‡∏™‡∏ä‡∏±‡∏ô
- ‡∏£‡∏≠‡πÉ‡∏´‡πâ token ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)
- ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ñ‡∏π‡∏Å redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ login

### ‡∏Å‡∏≤‡∏£ Debug

#### 1. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console
```typescript
// ‡∏î‡∏π log ‡∏Ç‡∏≠‡∏á token validation
console.log('[B2B] Token validation result:', token ? 'valid' : 'invalid');
```

#### 2. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Network Tab
- ‡∏î‡∏π API calls ‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÑ‡∏õ
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Authorization headers
- ‡∏î‡∏π response status codes

#### 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Application Tab
- ‡∏î‡∏π localStorage ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö `b2b_auth_token`
- ‡∏î‡∏π cookies ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö `b2b_token`

### ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

1. **JWT Secret** ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô production ‡πÅ‡∏•‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
2. **Token Expiration** ‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ‡∏ó‡∏µ‡πà 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
3. **Cookie Settings** ‡πÉ‡∏ä‡πâ `httpOnly: true` ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
4. **Error Handling** ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ error cases ‡∏ï‡πà‡∏≤‡∏á‡πÜ

### ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï

1. **Redis Cache** - ‡πÉ‡∏ä‡πâ Redis ‡πÅ‡∏ó‡∏ô global cache ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö OTP
2. **Refresh Token** - ‡πÄ‡∏û‡∏¥‡πà‡∏° refresh token mechanism
3. **Rate Limiting** - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API
4. **Audit Log** - ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏£‡∏∞‡∏ö‡∏ö

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç

### 1. MongoDB Connection Error

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** `MongooseServerSelectionError: getaddrinfo ENOTFOUND mongodb-s3ss.railway.internal`

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** 
- MONGODB_URI ‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏ô Railway
- MongoDB service ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**

#### ‡πÉ‡∏ô Railway Dashboard:
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å B2B Service
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö "Variables"
3. ‡πÄ‡∏û‡∏¥‡πà‡∏° environment variable:
   ```
   MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/winrichdynamic_b2b?retryWrites=true&w=majority
   ```

#### ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏° MongoDB Service:
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö "New Service"
2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "Database" > "MongoDB"
3. Railway ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á MONGODB_URI ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
4. ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å MONGODB_URI ‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô environment variables

### 2. Duplicate Schema Index Warnings

**‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** 
```
[MONGOOSE] Warning: Duplicate schema index on {"phone":1} found
[MONGOOSE] Warning: Duplicate schema index on {"name":1} found
[MONGOOSE] Warning: Duplicate schema index on {"slug":1} found
[MONGOOSE] Warning: Duplicate schema index on {"sku":1} found
```

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:** ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® index ‡∏ã‡πâ‡∏≥‡πÉ‡∏ô Mongoose schema

**‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‚úÖ **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß:** ‡∏•‡∏ö `unique: true` ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å field definition
- ‚úÖ **‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß:** ‡∏¢‡πâ‡∏≤‡∏¢ unique constraint ‡πÑ‡∏õ‡∏ó‡∏µ‡πà `schema.index()` ‡πÅ‡∏ó‡∏ô

**‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- `src/models/Admin.ts` - ‡∏•‡∏ö unique ‡∏à‡∏≤‡∏Å phone field
- `src/models/Product.ts` - ‡∏•‡∏ö unique ‡∏à‡∏≤‡∏Å sku field  
- `src/models/Category.ts` - ‡∏•‡∏ö unique ‡∏à‡∏≤‡∏Å slug field

### 3. ‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Environment Variables

**‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏ô Railway:**
```bash
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö environment variables ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô
MONGODB_URI=‚úÖ (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ)
JWT_SECRET=‚úÖ (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ)
NODE_ENV=production
PORT=8080 (Railway ‡∏à‡∏∞‡∏ï‡∏±‡πâ‡∏á‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)
```

### 4. ‡∏Å‡∏≤‡∏£ Debug MongoDB Connection

**‡πÄ‡∏û‡∏¥‡πà‡∏° logging ‡πÉ‡∏ô `src/lib/mongodb.ts`:**
```typescript
console.log('[B2B] MONGODB_URI:', MONGODB_URI?.substring(0, 20) + '...');
```

**‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö connection:**
```bash
# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logs ‡πÉ‡∏ô Railway
railway logs

# ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö environment variables
railway variables
```

### 5. ‡∏Å‡∏≤‡∏£ Restart Service

**‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç environment variables:**
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Railway Dashboard
2. ‡∏Å‡∏î "Deploy" ‡πÄ‡∏û‡∏∑‡πà‡∏≠ restart service
3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö logs ‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

### 6. Health Check

**‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ service ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô:**
```bash
curl https://your-railway-app.railway.app/api/ping
```

**‡∏Ñ‡∏ß‡∏£‡πÑ‡∏î‡πâ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå:**
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T00:00:00.000Z",
  "service": "winrichdynamic-b2b"
}
```

## ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß

### ‚úÖ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Duplicate Index Warnings
1. **Admin.ts** - ‡∏¢‡πâ‡∏≤‡∏¢ unique constraint ‡∏à‡∏≤‡∏Å field definition ‡πÑ‡∏õ‡∏ó‡∏µ‡πà index
2. **Product.ts** - ‡∏¢‡πâ‡∏≤‡∏¢ unique constraint ‡∏à‡∏≤‡∏Å field definition ‡πÑ‡∏õ‡∏ó‡∏µ‡πà index  
3. **Category.ts** - ‡∏¢‡πâ‡∏≤‡∏¢ unique constraint ‡∏à‡∏≤‡∏Å field definition ‡πÑ‡∏õ‡∏ó‡∏µ‡πà index

### ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á MongoDB Connection
1. ‡πÄ‡∏û‡∏¥‡πà‡∏° error logging
2. ‡πÄ‡∏û‡∏¥‡πà‡∏° connection options ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Railway
3. ‡πÄ‡∏û‡∏¥‡πà‡∏° retry logic

### ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á Error Handling
1. ‡πÄ‡∏û‡∏¥‡πà‡∏° detailed error messages
2. ‡πÄ‡∏û‡∏¥‡πà‡∏° connection timeout settings
3. ‡πÄ‡∏û‡∏¥‡πà‡∏° graceful shutdown

## ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç

**‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô B2B Subdomain Service ‡∏ó‡∏µ‡πà‡πÅ‡∏¢‡∏Å‡∏à‡∏≤‡∏Å‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏´‡∏•‡∏±‡∏Å**
- ‡∏´‡πâ‡∏≤‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏≠‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå `winrichdynamic-service`
- ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡πÉ‡∏ô‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ô‡∏µ‡πâ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
- ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡πá‡∏Å‡∏ô‡∏µ‡πâ‡∏£‡∏±‡∏ô‡∏ö‡∏ô Railway ‡πÄ‡∏õ‡πá‡∏ô subdomain ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å

## ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠

‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ç‡πâ‡∏≤‡∏á‡∏ï‡πâ‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏û‡∏±‡∏í‡∏ô‡∏≤
